{% extends "base/base.html" %}
{% load static %}

{% block content %}
  <main>
    <div class="page-header">
      <div class="container">
        <h1>Оформлення замовлення</h1>
      </div>
    </div>

    <div class="container checkout-layout">

      <div class="cart-summary">
        <h2>Ваше замовлення</h2>
        {% if messages %}
          <ul class="messages">
            {% for message in messages %}
              <li class="{{ message.tags }}">
                {{ message }}
              </li>
            {% endfor %}
          </ul>
        {% endif %}
        <form action="{% url 'library:update_cart' %}" method="post">
          {% csrf_token %}
          <ul class="checkout-items">
            {% for item in cart_items %}
              <li class="checkout-item" data-book-id="{{ item.book.pk }}" data-price="{{ item.price }}">
                <div class="item-image">...</div>
                <div class="item-details">
                  <h4>{{ item.book.title }}</h4>
                  <p>Автор: {{ item.book.authors.all|join:", " }}</p>
                  <p>Ціна: <strong>{{ item.book.price }} грн</strong></p>
                </div>
                <div class="item-quantity">
                  <label for="quantity-{{ item.book.pk }}">Кількість:</label>
                  <input
                      type="number"
                      id="quantity-{{ item.book.pk }}"
                      name="quantity_{{ item.book.pk }}"
                      value="{{ item.quantity }}"
                      min="1"
                      max="100"
                      onchange="this.form.submit()">
                </div>
                <div class="item-actions">
                  <a href="{% url 'library:delete_book_from_order' item.book.pk %}" class="btn-remove">✖</a>
                </div>
              </li>
            {% endfor %}
          </ul>
          <div class="total-price">
            Загальна сума: <span>{{ order.total_amount }} грн</span>
          </div>
        </form>
      </div>

      <div class="checkout-form">
        <h2>Інформація для доставки</h2>

        <form action="" method="post">
          {% csrf_token %}
          {{ form_order.as_p }}
          <button type="submit" class="btn">Підтвердити замовлення</button>
        </form>
      </div>

    </div>
  </main>
{% endblock %}